<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5 五子棋游戏</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <noscript>
        <div class="noscript-warning">
            请启用JavaScript以体验完整的H5五子棋游戏。
        </div>
    </noscript>

    <main class="app-container">
        <!-- 快捷设置按钮 -->
        <div class="quick-settings">
            <button id="settings-button" type="button" class="quick-settings-button" title="设置">
                ⚙️
            </button>
            <button id="help-button" type="button" class="quick-settings-button" title="帮助">
                ❓
            </button>
        </div>

        <header class="app-header">
            <div class="header-content">
                <h1>🎮 五子棋</h1>
                <p class="subtitle">纯原生JavaScript · 模块化架构 · Canvas渲染</p>
            </div>
        </header>

        <div class="main-layout">
            <!-- 左侧：棋盘 + 状态显示 -->
            <div class="board-panel">
                <!-- 游戏状态卡片 -->
                <div class="game-status-card">
                    <div class="status-header">
                        <div class="player-indicator">
                            <div class="player-info player-black">
                                <div class="player-avatar">●</div>
                                <div class="player-details">
                                    <span class="player-label">黑方</span>
                                    <span class="player-status" id="black-status">等待中</span>
                                </div>
                            </div>
                            <div class="vs-divider">VS</div>
                            <div class="player-info player-white">
                                <div class="player-avatar">○</div>
                                <div class="player-details">
                                    <span class="player-label">白方</span>
                                    <span class="player-status" id="white-status">等待中</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="game-info-bar">
                        <div class="info-item">
                            <span class="info-icon">🎯</span>
                            <span class="info-text" id="current-mode">PvP模式</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">📊</span>
                            <span class="info-text" id="move-count">回合 0</span>
                        </div>
                    </div>
                </div>

                <!-- 棋盘 -->
                <section class="board-section">
                    <canvas id="game-board" width="0" height="0">
                        您的浏览器暂不支持Canvas，请升级或更换浏览器。
                    </canvas>
                </section>

                <!-- 状态消息 -->
                <div class="status-message-area" id="status-panel">
                    <p>正在初始化...</p>
                </div>
            </div>

            <!-- 右侧：控制面板 -->
            <section class="controls-section">
                <!-- Tab导航 -->
                <div class="control-tabs">
                    <button class="tab-button active" data-tab="game">
                        <span class="tab-icon">🎮</span>
                        <span class="tab-label">游戏</span>
                    </button>
                    <button class="tab-button" data-tab="save">
                        <span class="tab-icon">💾</span>
                        <span class="tab-label">存档</span>
                    </button>
                    <button class="tab-button" data-tab="replay">
                        <span class="tab-icon">📹</span>
                        <span class="tab-label">回放</span>
                    </button>
                    <button class="tab-button" data-tab="vcf">
                        <span class="tab-icon">🎯</span>
                        <span class="tab-label">练习</span>
                    </button>
                </div>

                <!-- Tab内容 -->
                <div class="tab-content-container">
                    <!-- 游戏控制Tab -->
                    <div class="tab-content active" id="tab-game">
                        <div class="control-section">
                            <h3 class="section-title">游戏模式</h3>
                            <div class="mode-selector">
                                <button id="mode-pvp" type="button" class="mode-card active">
                                    <span class="mode-icon">👥</span>
                                    <span class="mode-name">PvP</span>
                                    <span class="mode-desc">玩家对战</span>
                                </button>
                                <button id="mode-pve" type="button" class="mode-card">
                                    <span class="mode-icon">🤖</span>
                                    <span class="mode-name">PvE</span>
                                    <span class="mode-desc">人机对战</span>
                                </button>
                                <button id="mode-eve" type="button" class="mode-card">
                                    <span class="mode-icon">⚙️</span>
                                    <span class="mode-name">EvE</span>
                                    <span class="mode-desc">AI演示</span>
                                </button>
                                <button id="mode-vcf" type="button" class="mode-card">
                                    <span class="mode-icon">🎓</span>
                                    <span class="mode-name">VCF</span>
                                    <span class="mode-desc">练习模式</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section difficulty-section" style="display: none;">
                            <h3 class="section-title">AI难度</h3>
                            <div class="difficulty-grid">
                                <button type="button" class="difficulty-option" data-difficulty="BEGINNER">
                                    <span class="difficulty-emoji">😊</span>
                                    <span class="difficulty-name">新手</span>
                                </button>
                                <button type="button" class="difficulty-option active" data-difficulty="NORMAL">
                                    <span class="difficulty-emoji">🙂</span>
                                    <span class="difficulty-name">普通</span>
                                </button>
                                <button type="button" class="difficulty-option" data-difficulty="HARD">
                                    <span class="difficulty-emoji">😤</span>
                                    <span class="difficulty-name">困难</span>
                                </button>
                                <button type="button" class="difficulty-option" data-difficulty="HELL">
                                    <span class="difficulty-emoji">😈</span>
                                    <span class="difficulty-name">地狱</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <h3 class="section-title">快速操作</h3>
                            <div class="action-buttons">
                                <button id="new-game-button" type="button" class="action-btn primary">
                                    <span class="btn-icon">🆕</span>
                                    <span class="btn-text">新游戏</span>
                                </button>
                                <button id="undo-button" type="button" class="action-btn secondary" disabled>
                                    <span class="btn-icon">↩️</span>
                                    <span class="btn-text">悔棋</span>
                                </button>
                                <button id="hint-button" type="button" class="action-btn accent" disabled>
                                    <span class="btn-icon">💡</span>
                                    <span class="btn-text">提示</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 存档管理Tab -->
                    <div class="tab-content" id="tab-save">
                        <div class="control-section">
                            <h3 class="section-title">存档操作</h3>
                            <div class="action-buttons">
                                <button id="save-button" type="button" class="action-btn success">
                                    <span class="btn-icon">💾</span>
                                    <span class="btn-text">保存棋局</span>
                                </button>
                                <button id="load-button" type="button" class="action-btn info">
                                    <span class="btn-icon">📂</span>
                                    <span class="btn-text">加载棋局</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <h3 class="section-title">自动保存</h3>
                            <button id="auto-save-button" type="button" class="toggle-btn">
                                <span class="toggle-icon">🔄</span>
                                <span class="toggle-text">自动保存：关闭</span>
                            </button>
                            <p class="section-hint">开启后每次落子自动保存至本地</p>
                        </div>
                    </div>

                    <!-- 回放Tab -->
                    <div class="tab-content" id="tab-replay">
                        <div class="control-section">
                            <h3 class="section-title">回放控制</h3>
                            <div class="action-buttons">
                                <button id="replay-current-button" type="button" class="action-btn info">
                                    <span class="btn-icon">📹</span>
                                    <span class="btn-text">回放当前</span>
                                </button>
                                <button id="replay-loaded-button" type="button" class="action-btn info">
                                    <span class="btn-icon">📂</span>
                                    <span class="btn-text">回放载入</span>
                                </button>
                                <button id="replay-stop-button" type="button" class="action-btn danger">
                                    <span class="btn-icon">⏹️</span>
                                    <span class="btn-text">退出回放</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <h3 class="section-title">播放控制</h3>
                            <div class="replay-toolbar">
                                <button id="replay-step-backward-button" type="button" class="replay-control-btn">
                                    <span>⏮️</span>
                                </button>
                                <button id="replay-play-button" type="button" class="replay-control-btn primary">
                                    <span>▶️</span>
                                </button>
                                <button id="replay-pause-button" type="button" class="replay-control-btn">
                                    <span>⏸️</span>
                                </button>
                                <button id="replay-step-forward-button" type="button" class="replay-control-btn">
                                    <span>⏭️</span>
                                </button>
                            </div>
                            
                            <div class="replay-progress-container">
                                <input type="range" id="replay-progress" min="0" max="100" value="0" class="replay-slider">
                                <div class="replay-info">
                                    <span id="replay-progress-label" class="replay-step-text">0 / 0</span>
                                    <select id="replay-speed-select" class="replay-speed-select">
                                        <option value="0.5">0.5x</option>
                                        <option value="1" selected>1x</option>
                                        <option value="2">2x</option>
                                        <option value="3">3x</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VCF练习Tab -->
                    <div class="tab-content" id="tab-vcf">
                        <div class="control-section">
                            <h3 class="section-title">难度选择</h3>
                            <div class="vcf-level-grid">
                                <button type="button" class="vcf-level-option active" data-level="1">
                                    <span class="level-badge">Lv.1</span>
                                    <span class="level-name">入门</span>
                                    <span class="level-desc">2-3步</span>
                                </button>
                                <button type="button" class="vcf-level-option" data-level="2">
                                    <span class="level-badge">Lv.2</span>
                                    <span class="level-name">初级</span>
                                    <span class="level-desc">3-4步</span>
                                </button>
                                <button type="button" class="vcf-level-option" data-level="3">
                                    <span class="level-badge">Lv.3</span>
                                    <span class="level-name">中级</span>
                                    <span class="level-desc">5-7步</span>
                                </button>
                                <button type="button" class="vcf-level-option" data-level="4">
                                    <span class="level-badge">Lv.4</span>
                                    <span class="level-name">高级</span>
                                    <span class="level-desc">8-12步</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-section">
                            <h3 class="section-title">练习操作</h3>
                            <div class="action-buttons">
                                <button id="vcf-start-button" type="button" class="action-btn primary">
                                    <span class="btn-icon">▶️</span>
                                    <span class="btn-text">开始练习</span>
                                </button>
                                <button id="vcf-restart-button" type="button" class="action-btn secondary" disabled>
                                    <span class="btn-icon">🔄</span>
                                    <span class="btn-text">重新开始</span>
                                </button>
                            </div>
                            <div class="action-buttons">
                                <button id="vcf-hint-button" type="button" class="action-btn accent" disabled>
                                    <span class="btn-icon">💡</span>
                                    <span class="btn-text">查看提示</span>
                                </button>
                                <button id="vcf-solution-button" type="button" class="action-btn info" disabled>
                                    <span class="btn-icon">📖</span>
                                    <span class="btn-text">查看解法</span>
                                </button>
                            </div>
                        </div>

                        <div class="vcf-status-card" id="vcf-status-card" style="display: none;">
                            <div class="vcf-header">
                                <h4 id="vcf-puzzle-name">VCF练习</h4>
                                <span class="vcf-level-badge" id="vcf-puzzle-level">Level 1</span>
                            </div>
                            <p class="vcf-description" id="vcf-puzzle-description">选择难度并点击"开始练习"</p>
                            
                            <div class="vcf-progress-stats">
                                <div class="stat-item">
                                    <span class="stat-label">当前进度</span>
                                    <span class="stat-value" id="vcf-progress-text">0 / 0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">累计完成</span>
                                    <span class="stat-value" id="vcf-overall-progress">0 / 40</span>
                                </div>
                            </div>

                            <div class="vcf-hint-section">
                                <div class="hint-box next-step">
                                    <span class="hint-label">📌 下一关键点</span>
                                    <p id="vcf-next-step-text">-</p>
                                </div>
                                <div class="hint-box hint-info">
                                    <span class="hint-label">💡 提示</span>
                                    <p id="vcf-hint-text">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer class="app-footer">
            <p class="version-info">H5 五子棋 v8.0.3</p>
        </footer>
    </main>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚙️ 游戏设置</h2>
                <button class="modal-close" id="settings-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-show-coords" class="setting-checkbox">
                        <span class="setting-title">显示坐标</span>
                    </label>
                    <p class="setting-description">在棋盘上显示坐标标识</p>
                </div>
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-animations" class="setting-checkbox" checked>
                        <span class="setting-title">动画效果</span>
                    </label>
                    <p class="setting-description">开启界面动画效果</p>
                </div>
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-sound" class="setting-checkbox">
                        <span class="setting-title">音效</span>
                    </label>
                    <p class="setting-description">开启游戏音效（落子、胜利、提示等）</p>
                </div>
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-auto-hint" class="setting-checkbox" checked>
                        <span class="setting-title">自动提示禁手</span>
                    </label>
                    <p class="setting-description">在可能的禁手位置显示红色标记</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-primary" id="settings-save-button">保存设置</button>
                <button class="modal-button modal-button-secondary" id="settings-reset-button">恢复默认</button>
            </div>
        </div>
    </div>

    <!-- 帮助模态框 -->
    <div id="help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h2>❓ 帮助文档</h2>
                <button class="modal-close" id="help-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>📖 游戏规则</h3>
                    <p>五子棋是一种两人对弈的策略棋盘游戏。</p>
                    <ul>
                        <li><strong>目标</strong>：率先在棋盘上形成横、竖、斜任一方向的连续五个同色棋子</li>
                        <li><strong>规则</strong>：黑方先手，双方轮流落子，每次落一枚棋子</li>
                        <li><strong>胜利</strong>：首先形成五连者获胜</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>⚖️ 禁手规则（仅黑方）</h3>
                    <p>为平衡先手优势，黑方受到禁手限制：</p>
                    <ul>
                        <li><strong>长连禁手</strong>：六个或更多连续同色棋子（黑方判负）</li>
                        <li><strong>三三禁手</strong>：一步棋同时形成两个或以上的活三</li>
                        <li><strong>四四禁手</strong>：一步棋同时形成两个或以上的冲四</li>
                        <li><strong>五连优先</strong>：如果一步棋同时形成五连和禁手，则五连优先，黑方获胜</li>
                    </ul>
                    <p>⚠️ 白方不受禁手限制。</p>
                </div>
                <div class="help-section">
                    <h3>🎮 游戏模式</h3>
                    <ul>
                        <li><strong>PvP</strong> - 玩家对战：双人对弈模式</li>
                        <li><strong>PvE</strong> - 人机对战：与AI对弈，可选择难度</li>
                        <li><strong>EvE</strong> - AI演示：观看AI自我对弈</li>
                        <li><strong>VCF练习</strong> - 胜利练习：40道VCF题库，4个难度等级</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>🤖 AI难度</h3>
                    <ul>
                        <li><strong>新手</strong> - 随机落子</li>
                        <li><strong>普通</strong> - 基础评分算法</li>
                        <li><strong>困难</strong> - 高级评分+威胁分析</li>
                        <li><strong>地狱</strong> - 极限搜索+VCF检测</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>🎯 VCF练习模式</h3>
                    <p>VCF（Victory by Continuous Four）即连续冲四杀。</p>
                    <ul>
                        <li><strong>Level 1</strong> - 入门：2-3步必胜</li>
                        <li><strong>Level 2</strong> - 初级：3-4步必胜</li>
                        <li><strong>Level 3</strong> - 中级：5-7步必胜</li>
                        <li><strong>Level 4</strong> - 高级：8-12步必胜</li>
                    </ul>
                    <p>💡 在VCF模式下，点击"查看提示"可获得下一步的提示。</p>
                </div>
                <div class="help-section">
                    <h3>⌨️ 快捷功能</h3>
                    <ul>
                        <li><strong>提示按钮</strong> - 显示AI建议的最佳落子位置（3秒冷却）</li>
                        <li><strong>悔棋</strong> - 撤销上一步棋（回放模式下不可用）</li>
                        <li><strong>保存/加载</strong> - 保存当前棋局或加载已保存的棋局</li>
                        <li><strong>回放功能</strong> - 回放当前对局或已加载的对局</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>📱 关于项目</h3>
                    <p>H5五子棋游戏是一个纯原生JavaScript实现的Web应用，采用模块化架构设计。</p>
                    <ul>
                        <li><strong>技术栈</strong>：HTML5 Canvas + JavaScript ES6+ + CSS3</li>
                        <li><strong>特色</strong>：无框架依赖、模块化API、事件驱动架构</li>
                        <li><strong>版本</strong>：v8.0.3</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-primary" id="help-close-button">关闭</button>
            </div>
        </div>
    </div>

    <!-- 兼容旧版的隐藏select -->
    <select id="difficulty-select" style="display: none;">
        <option value="BEGINNER">新手</option>
        <option value="NORMAL" selected>普通</option>
        <option value="HARD">困难</option>
        <option value="HELL">地狱</option>
    </select>
    <select id="vcf-level-select" style="display: none;">
        <option value="1" selected>入门 (Level 1)</option>
        <option value="2">初级 (Level 2)</option>
        <option value="3">中级 (Level 3)</option>
        <option value="4">高级 (Level 4)</option>
    </select>

    <script src="js/utils.js"></script>
    <script src="js/sound-manager.js"></script>
    <script src="js/game-core.js"></script>
    <script src="js/ai-advanced.js"></script>
    <script src="js/board-renderer.js"></script>
    <script src="js/game-save-load.js"></script>
    <script src="js/game-replay.js"></script>
    <script src="js/vcf-practice.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/demo.js"></script>
